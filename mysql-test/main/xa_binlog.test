--source include/have_innodb.inc
--source include/have_log_bin.inc

# Range of valid formatID of XID's  [ gtrid, bqual [ , formatID ] ]
# is constrained to 2^32-2 as max(uint32) = -1 for 'long' on 32 bit platform
# and -1 is an invalid value.

--let $max_uint32 = `SELECT (1 << 32) - 1`
--let $max_fmt_id = `SELECT $max_uint32 - 1`
--error ER_XAER_NOTA
--eval XA START      '','', $max_uint32
--eval XA START      '','', $max_fmt_id
--eval XA END        '','', $max_fmt_id
--eval XA ROLLBACK   '','', $max_fmt_id

CREATE TABLE t1 (a INT PRIMARY KEY) ENGINE=InnoDB;

# Fix binlog format (otherwise SHOW BINLOG EVENTS will fluctuate).
SET binlog_format= mixed;

RESET MASTER;

XA START 'xatest';
INSERT INTO t1 VALUES (1);
XA END 'xatest';
XA PREPARE 'xatest';
XA COMMIT 'xatest';

XA START 'xatest';
INSERT INTO t1 VALUES (2);
XA END 'xatest';
XA COMMIT 'xatest' ONE PHASE;

BEGIN;
INSERT INTO t1 VALUES (3);
COMMIT;

SELECT * FROM t1 ORDER BY a;

--replace_column 2 # 5 #
--replace_regex /xid=[0-9]+/xid=XX/ /GTID [0-9]+-[0-9]+-[0-9]+/GTID #-#-#/
SHOW BINLOG EVENTS LIMIT 3,12;

DROP TABLE t1;
